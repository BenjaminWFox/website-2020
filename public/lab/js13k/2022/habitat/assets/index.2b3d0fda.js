let t,e,i=()=>{},s={};function n(t,...e){(s[t]||[]).map((t=>t(...e)))}let h={get:(t,e)=>"_proxy"==e||i};function o(){return t}function r(){return e}function a(t,e,i){return Math.min(Math.max(t,i),e)}class d{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new d(this.x+t.x,this.y+t.y,this)}subtract(t){return new d(this.x-t.x,this.y-t.y,this)}scale(t){return new d(this.x*t,this.y*t)}normalize(t=this.length()){return new d(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?a(this._a,this._d,t):t}set y(t){this._y=this._c?a(this._b,this._e,t):t}}function c(){return new d(...arguments)}class l extends class{constructor(t){return this.init(t)}init(t={}){this.position=c(),this.velocity=c(),this.acceleration=c(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=r(),render:s=this.draw,update:n=this.advance,children:h=[],anchor:o={x:0,y:0},opacity:a=1,rotation:d=0,scaleX:c=1,scaleY:l=1,...u}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:o,opacity:a,rotation:d,scaleX:c,scaleY:l,...u}),this._di=!0,this._uw(),this.addChild(h),this._rf=s,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:o,y:r}=((t,e)=>{let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}})({x:this._wx,y:this._wy},s);this._wx=o,this._wy=r,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||i,t._pc()}))}removeChild(...t){t.flat().map((t=>{((t,e)=>{let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class u extends l{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function p(){return new u(...arguments)}let w=/(\d+)(\w+)/;class x extends l{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=r().font,...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=(t=>{let e=t.match(w),i=+e[1];return{size:i,unit:e[2],computed:i}})(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,s=2;for(;s<=e.length;s++){let n=e.slice(i,s).join(" ");t.measureText(n).width>this._fw&&(this._s.push(e.slice(i,s-1).join(" ")),i=s-1)}this._s.push(e.slice(i,s).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,n)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*n)}))}}function _(){return new x(...arguments)}let g=new WeakMap,f={},y={},m={0:"left",1:"middle",2:"right"};function b(t,e){let{x:i,y:s,width:n,height:h}=(t=>{let{x:e=0,y:i=0,width:s,height:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,n=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=n*t.anchor.y),0>s&&(e+=s,s*=-1),0>n&&(i+=n,n*=-1),{x:e,y:i,width:s,height:n}})(t);do{i-=t.sx||0,s-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(i,Math.min(e.x,i+n)),r=e.y-Math.max(s,Math.min(e.y,s+h));return o*o+r*r<e.radius*e.radius}function v(t,e){return parseFloat(t.getPropertyValue(e))||0}function M(t){let e=null!=t.button?m[t.button]:"left";y[e]=!0,D(t,"onDown")}function S(t){let e=null!=t.button?m[t.button]:"left";y[e]=!1,D(t,"onUp")}function E(t){D(t,"onOver")}function A(t){g.get(t.target)._oo=null,y={}}function Y(t,e,i){let s=(t=>{let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):b(s,t))return s}})(t);s&&s[e]&&s[e](i),f[e]&&f[e](i,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function D(t,e){t.preventDefault();let i=t.target,s=g.get(i),{scaleX:h,scaleY:o,offsetX:r,offsetY:a}=(t=>{let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(n[0]),o=parseFloat(n[3]),r=(v(i,"border-left-width")+v(i,"border-right-width"))*h,a=(v(i,"border-top-width")+v(i,"border-bottom-width"))*o,d=(v(i,"padding-left")+v(i,"padding-right"))*h,c=(v(i,"padding-top")+v(i,"padding-bottom"))*o;return{scaleX:(s.width-r-d)/e.width,scaleY:(s.height-a-c)/e.height,offsetX:s.left+(v(i,"border-left-width")+v(i,"padding-left"))*h,offsetY:s.top+(v(i,"border-top-width")+v(i,"padding-top"))*o}})(s);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let n=s.touches[i];n||(n=s.touches[i]={start:{x:(t-r)/h,y:(e-a)/o}},s.touches.length++),n.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:d,identifier:c})=>{let l=s.touches[c];l.changed=!0,l.x=s.x=(i-r)/h,l.y=s.y=(d-a)/o,Y(s,e,t),n("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[c],s.touches.length--,s.touches.length||n("touchEnd"))}))):(s.x=(t.clientX-r)/h,s.y=(t.clientY-a)/o,Y(s,e,t))}function C({radius:t=5,canvas:e=o()}={}){let i=g.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},g.set(e,i)}var n;return e.addEventListener("mousedown",M),e.addEventListener("touchstart",M),e.addEventListener("mouseup",S),e.addEventListener("touchend",S),e.addEventListener("touchcancel",S),e.addEventListener("blur",A),e.addEventListener("mousemove",E),e.addEventListener("touchmove",E),i._t||(i._t=!0,n=()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0},s.tick=s.tick||[],s.tick.push(n)),i}class k extends u{init({padX:t=0,padY:e=0,text:s,disabled:n=!1,onDown:h,onUp:r,...a}={}){super.init({padX:t,padY:e,...a}),this.textNode=_({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),function(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:o(),i=g.get(e);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))}))}(this),this.addChild(this.textNode),this._od=h||i,this._ou=r||i;let d=this._dn=document.createElement("button");d.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",d.textContent=this.text,n&&this.disable(),d.addEventListener("focus",(()=>this.focus())),d.addEventListener("blur",(()=>this.blur())),d.addEventListener("keydown",(t=>this._kd(t))),d.addEventListener("keyup",(t=>this._ku(t))),((t,e)=>{let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,s.nextSibling)}else document.body.appendChild(t)})(d,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+2*this.padX,e=this.textNode.height+2*this.padY;this.width=Math.max(t,this.width),this.height=Math.max(e,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){"Enter"!=t.code&&"Space"!=t.code||this.onDown()}_ku(t){"Enter"!=t.code&&"Space"!=t.code||this.onUp()}}function P(){return new k(...arguments)}function X(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}let L={},O={},j={},I={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function U(t=i,e){t._pd&&e.preventDefault(),t(e)}function W(t){let e=I[t.code],i=L[e];j[e]=!0,U(i,t)}function N(t){let e=I[t.code],i=O[e];j[e]=!1,U(i,t)}function H(){j={}}let{canvas:F,context:T}=((i,{contextless:s=!1}={})=>{if(t=document.getElementById(i)||i||document.querySelector("canvas"),s&&(t=t||new Proxy({},h)),!t)throw Error("You must provide a canvas element for the game");return e=t.getContext("2d")||new Proxy({},h),e.imageSmoothingEnabled=!1,n("init"),{canvas:t,context:e}})();function R(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function B(t,e,i,s=0){const n=i?.75:0,h=e.x>t.x+t.width+s,o=e.x+e.width<t.x-s+t.width*n;if(h||o)return!1;const r=e.y+e.height<t.y-s,a=e.y>t.y+t.height+s;return!r&&!a}function q(){let t=1600;return window.innerWidth>2*window.innerHeight?console.log("SET WIDTH",t):console.log("OTHER WIDTH",t),F.width=t,F.height=800,{playing:!1,menuing:!0,ending:!1,ratio:1,width:t,height:800,refWidth:80,maxDyUp:-8,maxDyDown:5.992509363295881,maxDyUpChange:Math.abs(-.4),maxDyDownChange:Math.abs(-.8),objectives:[],obstacles:[],distance:1,pickups:0,canvas:F,context:T,baseSpeed:-7,scrollSpeed:-3,font:"32px Arial",maxY:740,minY:20,taper:.05,lastObstacleSpawn:0,canSpawnObstacle:!1}}let z={...q(),setPlaying(){},setEnding(){},setMenuing(){}};z={...q(),setPlaying(){console.log("SIP"),z.playing=!0,z.ending=!1,z.menuing=!1},setEnding(){z.playing=!1,z.ending=!0,z.menuing=!1},setMenuing(){z.playing=!1,z.ending=!1,z.menuing=!0}};const $=.25*z.refWidth,K=$;function V(t,e){return p({x:t,y:e,color:"yellow",width:$,height:K,dy:0,dx:z.scrollSpeed})}class G{constructor(t,e,i){this.fn=t,this.yMin=e,this.yMax=i}function(t){const e=t||R(this.yMin,this.yMax);return t=>this.fn(t,e)}}const J=new G(((t,e)=>e*z.ratio+100*z.ratio*Math.sin(1*Math.PI*t+3)),50,750),Q=[J,new G(((t,e)=>e*z.ratio+150*z.ratio*Math.sin(1*Math.PI*t+3)),50,750),new G(((t,e)=>e*z.ratio-75*z.ratio*Math.sin(2.5*Math.PI*t*.1+3)),100,700),new G(((t,e)=>e*z.ratio+150*z.ratio*Math.sin(.1*Math.PI*t+3)),170,610),new G(((t,e)=>e*z.ratio+300*z.ratio*Math.sin(.1*Math.PI*t+0)),320,450),new G(((t,e)=>e*z.ratio+150*z.ratio*Math.sin(.04*Math.PI*t+3)),170,740),new G(((t,e)=>e*z.ratio+150*z.ratio*Math.sin(2.952*Math.PI*t+0)),170,610),new G(((t,e)=>e*z.ratio+50*z.ratio*Math.sin(2.94*Math.PI*t+0)),70,710)];function Z(t,e){const i=t||1.25*z.width;let s=Q[R(0,Q.length-1)].function();for(let n=0;21>n;n+=1){const t=i+2*$*n,h=e?e(n):s(n);z.objectives.push(V(t,h))}}const tt=.25*z.refWidth,et=10*tt,it=z.height-et-20*z.ratio,st=20*z.ratio;function nt(t,e){return p({x:t,y:e,color:"teal",width:tt,height:et,dy:0,dx:z.scrollSpeed})}C();const ht=P({x:.5*z.width,y:z.height/2-50*z.ratio,anchor:{x:.5,y:.5},text:{text:"Fly!",color:"white",font:z.font,anchor:{x:.5,y:.5}},onUp(){console.log("OUP"),z.setPlaying()},render(){this.context.lineWidth=5*z.ratio,this.context.strokeStyle="red"}}),ot=P({x:.7*z.width,y:z.height/2-50*z.ratio,anchor:{x:.5,y:.5},text:{text:"Buy!",color:"white",font:z.font,anchor:{x:.5,y:.5}},render(){this.context.lineWidth=5*z.ratio,this.context.strokeStyle="red",this.context?.strokeRect(100*z.ratio,60*z.ratio,this.width-200*z.ratio||0,this.height-100*z.ratio||0)}});(()=>{let t;for(t=0;26>t;t++)I["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;10>t;t++)I["Digit"+t]=I["Numpad"+t]=""+t;window.addEventListener("keydown",W),window.addEventListener("keyup",N),window.addEventListener("blur",H)})(),C(),document.createElement("canvas").getContext("2d");const rt=z.refWidth,at=rt/2;let dt=p({x:3*rt,y:z.height/2-at/2,color:"red",width:rt,height:at,dy:-20*z.ratio});Z(1.5*z.width,J.function(390)),(()=>{const t=z.width,e=z.height/2+et/2,i=1.35*z.width,s=z.height/2-1.5*et;z.obstacles.push(nt(t,e)),z.obstacles.push(nt(i,s))})();const ct=_({text:"",font:`${z.font}`,color:"white",x:20*z.ratio,y:20*z.ratio,textAlign:"left",anchor:{x:0,y:0}});function lt(t){return B(dt,t,!1)}function ut(t){return z.playing&&B(dt,t,!0,-2*z.ratio)}let pt=function({fps:t=60,clearCanvas:e=!0,update:s=i,render:h,context:o=r(),blur:a=!1}={}){if(!h)throw Error("You must provide a render() function");let d,c,l,u,p,w=0,x=1e3/t,_=1/t,g=e?X:i,f=!0;function y(){if(c=requestAnimationFrame(y),f&&(l=performance.now(),u=l-d,d=l,1e3>=u)){for(n("tick"),w+=u;w>=x;)p.update(_),w-=x;g(o),p.render()}}return a||(window.addEventListener("focus",(()=>{f=!0})),window.addEventListener("blur",(()=>{f=!1}))),p={update:s,render:h,isStopped:!0,start(){d=performance.now(),this.isStopped=!1,requestAnimationFrame(y)},stop(){this.isStopped=!0,cancelAnimationFrame(c)},_frame:y,set _last(t){d=t}},p}({update(){z.playing?(z.scrollSpeed=z.baseSpeed+z.baseSpeed*(z.distance/1e4),z.distance+=1):z.ending&&(0>z.scrollSpeed&&(z.scrollSpeed=Math.min(z.scrollSpeed+z.taper,0)),dt.dx>0&&(dt.dx=Math.max(dt.dx-z.taper,0))),(z.playing||z.ending)&&((()=>{for(let t=0;t<z.objectives.length;t+=1){const e=z.objectives[t];e.x<0-e.width?(z.objectives.splice(t,1),t-=1):lt(e)?(z.pickups+=1,z.objectives.splice(t,1),t-=1):(e.dx!==z.scrollSpeed&&(e.dx=z.scrollSpeed),e.update())}z.objectives.length&&z.objectives.at(-1).x<z.width&&Z()})(),(()=>{for(let t=0;t<z.obstacles.length;t+=1){const e=z.obstacles[t];e.x<0-e.width?(z.obstacles.splice(t,1),t-=1):(ut(e),e.dx!==z.scrollSpeed&&(e.dx=z.scrollSpeed),e.update())}z.distance-z.lastObstacleSpawn>150&&z.distance%50==0&&(z.canSpawnObstacle=!0),z.canSpawnObstacle&&30===R(1,30)&&(z.canSpawnObstacle=!1,z.lastObstacleSpawn=z.distance,(()=>{let t=nt(z.width+4*tt*z.ratio,R(st,it));z.objectives.forEach((e=>{if(B(e,t,!1,.5*e.width*z.ratio))for(;B(e,t,!1,.5*e.width*z.ratio);)t.y-=20*z.ratio,t.y<st&&(t.y=it)})),z.obstacles.push(t)})())})(),(j.space||y.left||((t=o())=>g.get(t))().touches.length>0)&&dt.dy>z.maxDyUp&&(z.playing||dt.dx>2*z.ratio)?dt.dy-=z.maxDyUpChange:dt.dy<z.maxDyDown&&(dt.dy+=z.maxDyDownChange),dt.y>z.maxY?(dt.y=z.maxY,dt.dy=0):dt.y<z.minY&&(dt.y=z.minY,dt.dy=0),dt.update()),z.menuing},render(){z.context.fillStyle="blue",z.context.fillRect(0,0,z.canvas.width,z.canvas.height),dt.render(),z.objectives.forEach((t=>{t.render()})),z.obstacles.forEach((t=>{t.render()})),ct.text=`Distance: ${z.distance} Pickups: ${z.pickups}`,ct.render(),z.menuing&&(ht.render(),ot.render())}});z.setPlaying(),pt.start();
